<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gntshr (xen-gnt.Gnt.Gntshr)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">xen-gnt</a> &#x00BB; <a href="../index.html">Gnt</a> &#x00BB; Gntshr</nav><header class="odoc-preamble"><h1>Module <code><span>Gnt.Gntshr</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#low-level-interface">Low-level interface</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-interface"><a href="#type-interface" class="anchor"></a><code><span><span class="keyword">type</span> interface</span></code></div><div class="spec-doc"><p>A connection to the gntshr device, needed for sharing/unmapping</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interface_open"><a href="#val-interface_open" class="anchor"></a><code><span><span class="keyword">val</span> interface_open : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-interface">interface</a></span></code></div><div class="spec-doc"><p>Open a connection to the gntshr device. This must be done before any calls to share or unmap.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-interface_close"><a href="#val-interface_close" class="anchor"></a><code><span><span class="keyword">val</span> interface_close : <span><a href="#type-interface">interface</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close a connection to the gntshr device. Any future calls to share or unmap will fail.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-share"><a href="#type-share" class="anchor"></a><code><span><span class="keyword">type</span> share</span><span> = </span><span>{</span></code><ol><li id="type-share.refs" class="def record field anchored"><a href="#type-share.refs" class="anchor"></a><code><span>refs : <span><a href="../index.html#type-gntref">gntref</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>List of grant references which have been shared with a foreign domain.</p><span class="comment-delim">*)</span></div></li><li id="type-share.mapping" class="def record field anchored"><a href="#type-share.mapping" class="anchor"></a><code><span>mapping : <span class="xref-unresolved">Io_page</span>.t;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Mapping of the shared memory.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>When sharing a number of pages with another domain, we receive back both the list of grant references shared and actually mapped page(s). The foreign domain can map the same shared memory, after being notified (e.g. via xenstore) of our domid and list of references.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-share_pages_exn"><a href="#val-share_pages_exn" class="anchor"></a><code><span><span class="keyword">val</span> share_pages_exn : <span><a href="#type-interface">interface</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> <a href="#type-share">share</a></span></code></div><div class="spec-doc"><p><code>share_pages_exn if domid count writable</code> shares <code>count</code> pages with foreign domain <code>domid</code>. <code>writable</code> determines whether or not the foreign domain can write to the shared memory.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-share_pages"><a href="#val-share_pages" class="anchor"></a><code><span><span class="keyword">val</span> share_pages : <span><a href="#type-interface">interface</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-share">share</a> option</span></span></code></div><div class="spec-doc"><p><code>share_pages if domid count writable</code> shares <code>count</code> pages with foreign domain <code>domid</code>. <code>writable</code> determines whether or not the foreign domain can write to the shared memory. On error this function returns None. Diagnostic details will be logged.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-munmap_exn"><a href="#val-munmap_exn" class="anchor"></a><code><span><span class="keyword">val</span> munmap_exn : <span><a href="#type-interface">interface</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-share">share</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Unmap a single mapping (which may involve multiple grants)</p></div></div><h3 id="low-level-interface"><a href="#low-level-interface" class="anchor"></a>Low-level interface</h3><p>This is is only available in kernelspace and is deprecated. For low-level access, use mirage-xen's OS.Xen API instead.</p><div class="odoc-spec"><div class="spec exception anchored" id="exception-Interface_unavailable"><a href="#exception-Interface_unavailable" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Interface_unavailable</span></span></code></div><div class="spec-doc"><p>Raised when the low-level grant table interface is not available</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-gntref">gntref</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Allocate a single grant table index</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_n"><a href="#val-get_n" class="anchor"></a><code><span><span class="keyword">val</span> get_n : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../index.html#type-gntref">gntref</a> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Allocate a block of n grant table indices</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-put"><a href="#val-put" class="anchor"></a><code><span><span class="keyword">val</span> put : <span><a href="../index.html#type-gntref">gntref</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Deallocate a grant table index</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_nonblock"><a href="#val-get_nonblock" class="anchor"></a><code><span><span class="keyword">val</span> get_nonblock : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-gntref">gntref</a> option</span></span></code></div><div class="spec-doc"><p><code>get_nonblock ()</code> is <code>Some idx</code> is the grant table is not full, or <code>None</code> otherwise.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_n_nonblock"><a href="#val-get_n_nonblock" class="anchor"></a><code><span><span class="keyword">val</span> get_n_nonblock : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-gntref">gntref</a> list</span></span></code></div><div class="spec-doc"><p><code>get_n_nonblock count</code> is a list of grant table indices of length <code>count</code>, or <code>[]</code> if there if the table is too full to accomodate <code>count</code> new grant references.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-num_free_grants"><a href="#val-num_free_grants" class="anchor"></a><code><span><span class="keyword">val</span> num_free_grants : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>num_free_grants ()</code> returns the number of instantaneously free grant table indices</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_ref"><a href="#val-with_ref" class="anchor"></a><code><span><span class="keyword">val</span> with_ref : <span><span>(<span><a href="../index.html#type-gntref">gntref</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_refs"><a href="#val-with_refs" class="anchor"></a><code><span><span class="keyword">val</span> with_refs : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><a href="../index.html#type-gntref">gntref</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-grant_access"><a href="#val-grant_access" class="anchor"></a><code><span><span class="keyword">val</span> grant_access : <span><span class="label">domid</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">writable</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-gntref">gntref</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Io_page</span>.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>grant_access ~domid ~writable gntref page</code> adds a grant table entry at index <code>gntref</code> to the grant table, granting access to <code>domid</code> to read <code>page</code>, and write to is as well if <code>writable</code> is <code>true</code>.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_access"><a href="#val-end_access" class="anchor"></a><code><span><span class="keyword">val</span> end_access : <span><a href="../index.html#type-gntref">gntref</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>end_access gntref</code> removes entry index <code>gntref</code> from the grant table.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_grant"><a href="#val-with_grant" class="anchor"></a><code><span><span class="keyword">val</span> with_grant : 
  <span><span class="label">domid</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">writable</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-gntref">gntref</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Io_page</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_grants"><a href="#val-with_grants" class="anchor"></a><code><span><span class="keyword">val</span> with_grants : 
  <span><span class="label">domid</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">writable</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../index.html#type-gntref">gntref</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Io_page</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use mirage-xen's OS.Xen API instead.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_gntshr"><a href="#val-with_gntshr" class="anchor"></a><code><span><span class="keyword">val</span> with_gntshr : <span><span>(<span><a href="#type-interface">interface</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_gntshr f</code> opens an interface to gntshr, passes it to f, then returns the result of f (or re-raises any exceptions) ensuring that the gntshr interface is closed before returning.</p></div></div></div></body></html>
